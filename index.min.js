var M=(r,t,f)=>{t=t||(n=>n),f=f||document;let c=n=>n&&typeof n=="object"&&!(n instanceof Array),a=(n,e)=>c(n)&&c(e)?{...n,...e}:e,v=(n,e)=>typeof n=="string"&&typeof e=="string"?n+e:e,l=n=>{if(n.nodeType!=1)return()=>[t(n.textContent)];let e=n.tagName.toLowerCase(),m=Array.from(n.attributes).map(({nodeName:i,nodeValue:s})=>({key:i,value:n.getAttribute(i)})),g=Array.from((e=="template"?n.content:n).childNodes).map(i=>l(i));return(i,s,b,E)=>m.reduce((j,C)=>j.reduce((u,y)=>{let{scope:o,attributes:A}=y;var{key:p,value:h}=C;return(p.substr(0,1)==":"||p.substr(p.length-1)==":")&&(p=p.substr(0,1)==":"?p.substr(1):p.substr(0,p.length-1),h==""?h=o:o&&typeof o=="object"&&o[h]!=null?h=o[h]:h=null),p=="each"?h instanceof Array&&h.forEach(O=>{u.push({attributes:{...A},scope:a(o,O)})}):p=="with"?h!=null&&u.push({...y,scope:a(o,h)}):p=="if"||p=="not"?(p=="if"&&h||p=="not"&&!h)&&u.push(y):p=="show"||p=="hide"?((p=="hide"&&h||p=="show"&&!h)&&(A.style="display: none;"+(typeof A.style=="string"?A.style:"")),u.push({...y,attributes:A})):p=="case"?s!=null&&s==h&&u.push(y):p=="switch"?u.push({...y,word:h}):p=="bind"?(h&&typeof h=="object"&&Object.keys(h).forEach(O=>{A[O]=v(A[O],h[O])}),u.push({...y,attributes:A})):(A[p]=v(A[p],h),u.push({...y,attributes:A})),u},[]),[{scope:e=="slot"?E:i,attributes:{}}]).reduce((j,{scope:C,attributes:u,word:y})=>{let o=(e=="slot"?b:g).reduce((h,O)=>(O(C,y,b||g,E).forEach(B=>{h.push(B)}),h),[]).filter(h=>h),A=e.indexOf("-")>=0?f.getElementById(e):null;if(u.text!=null&&A==null){for(;o.length;)o.pop();o.push(t(u.text)),u={...u},delete u.text}var p=null;return e=="template"||e=="slot"?p=o:A!=null?p=l(A)(u,null,g,C):p=[r(e,u,o)],p.forEach(h=>{j.push(h)}),j},[])};return(n,e)=>{if(e){let m=n.tagName.toLowerCase(),g=Array.from(n.attributes).reduce((s,{attrName:b,attrValue:E})=>({...s,[b]:E}),{}),i=l(e);return s=>r(m,g,i(s))}else{let m=l(n);return g=>m(g)[0]}}};var D=1,_=3,G={},U=[],Z="http://www.w3.org/2000/svg",P=function(r){this.events[r.type](r)},x=r=>r==null?r:r.key,z=(r,t,f,c,a)=>{t==="key"||(t[0]==="o"&&t[1]==="n"?((r.events||(r.events={}))[t=t.slice(2)]=c)?f||r.addEventListener(t,P):r.removeEventListener(t,P):!a&&t!=="list"&&t!=="form"&&t in r?r[t]=c??"":c==null||c===!1?r.removeAttribute(t):r.setAttribute(t,c))},I=(r,t)=>{var f=r.props,c=r.type===_?document.createTextNode(r.tag):(t=t||r.tag==="svg")?document.createElementNS(Z,r.tag,{is:f.is}):document.createElement(r.tag,{is:f.is});for(var a in f)z(c,a,null,f[a],t);for(var v=0;v<r.children.length;v++)c.appendChild(I(r.children[v]=L(r.children[v]),t));return r.node=c},R=(r,t,f,c,a)=>{if(f!==c)if(f!=null&&f.type===_&&c.type===_)f.tag!==c.tag&&(t.nodeValue=c.tag);else if(f==null||f.tag!==c.tag)t=r.insertBefore(I(c=L(c),a),t),f!=null&&r.removeChild(f.node);else{var v,l,n,e,m=f.props,g=c.props,i=f.children,s=c.children,b=0,E=0,j=i.length-1,C=s.length-1;a=a||c.tag==="svg";for(var u in{...m,...g})(u==="value"||u==="selected"||u==="checked"?t[u]:m[u])!==g[u]&&z(t,u,m[u],g[u],a);for(;E<=C&&b<=j&&!((n=x(i[b]))==null||n!==x(s[E]));)R(t,i[b].node,i[b++],s[E]=L(s[E++]),a);for(;E<=C&&b<=j&&!((n=x(i[j]))==null||n!==x(s[C]));)R(t,i[j].node,i[j--],s[C]=L(s[C--]),a);if(b>j)for(;E<=C;)t.insertBefore(I(s[E]=L(s[E++]),a),(l=i[b])&&l.node);else if(E>C)for(;b<=j;)t.removeChild(i[b++].node);else{for(var y={},o={},u=b;u<=j;u++)(n=i[u].key)!=null&&(y[n]=i[u]);for(;E<=C;){if(n=x(l=i[b]),e=x(s[E]=L(s[E])),o[n]||e!=null&&e===x(i[b+1])){n==null&&t.removeChild(l.node),b++;continue}e==null||f.type===D?(n==null&&(R(t,l&&l.node,l,s[E],a),E++),b++):(n===e?(R(t,l.node,l,s[E],a),o[e]=!0,b++):(v=y[e])!=null?(R(t,t.insertBefore(v.node,l&&l.node),v,s[E],a),o[e]=!0):R(t,l&&l.node,null,s[E],a),E++)}for(;b<=j;)x(l=i[b++])==null&&t.removeChild(l.node);for(var u in y)o[u]==null&&t.removeChild(y[u].node)}}return c.node=t},L=r=>r!==!0&&r!==!1&&r?r:q(""),F=r=>r.nodeType===_?q(r.nodeValue,r):J(r.nodeName.toLowerCase(),G,U.map.call(r.childNodes,F),D,r),J=(r,t,f,c,a)=>({tag:r,props:t,key:t.key,children:f,type:c,node:a}),q=(r,t)=>J(r,G,U,_,t),W=(r,t,f=U)=>J(r,t,Array.isArray(f)?f:[f]),Y=(r,t)=>((r=R(r.parentNode,r,r.vdom||F(r),t)).vdom=t,r);var $=({root:r,template:t,format:f,...c})=>{var a,v=!1;f=typeof f=="function"?f:e=>e,c.init=typeof c.init=="function"?c.init:e=>e,c.done=typeof c.done=="function"?c.done:()=>null;let l=(e,m)=>{if(e=="init"&&!v||e!="init"&&v&&typeof c[e]=="function"){v=!0;let g=e=="init"?c.init(m,l):e=="done"?c.done(a,l):c[e](a,m,l);a=g===void 0?a:g,e=="done"?v=!1:Y(r,n(f(a)))}},n=M((e,m,g)=>(Object.keys(m||{}).forEach(i=>{if(i.substr(0,7)=="data-on"&&(i=i.substr(5)),i.substr(0,2)=="on"){let s=m[i]||m["data-"+i];m[i]=b=>{l(s,b)}}}),W(e,m,g)),q)(r,t);return l},X=r=>({...r,Query:r.query.split("&").map(t=>t.split("=")).map(t=>({key:decodeURIComponent(t.shift()),value:decodeURIComponent(t.join("="))})).filter(({key:t})=>t!="").reduce((t,{key:f,value:c})=>(f.substr(f.length-2)=="[]"?(f=f.substr(0,f.length-2),t[f]instanceof Array||(t[f]=[]),t[f].push(c)):t[f]=c,t),{})}),k=({root:r,components:t,routes:f,middleware:c,...a})=>{r=r||document.body.querySelector("main")||document.body,f=f instanceof Array?f:[],c=[X].concat(c).filter(g=>typeof g=="function"),t=t&&typeof t=="object"?t:{};let v=document.createElement("template");f.length&&(Array.from(r.children).forEach(g=>{v.content.appendChild(g.cloneNode(!0))}),t.home={template:v});let l={},n=Object.keys(t).reduce((g,i)=>{let s=t[i];s.root==null&&(s.root=r),s.root==r&&f.length&&s.template==null&&(s.template=v);let b=$(s);return g.push(b),s.root!=r||!f.length?b("init",a[i]):l[i]=b,g},[]);var e=l.home;let m=()=>{let g=window.location.hash,i=g.split("?"),s=i.shift(),b=i.join("?"),E=s.split("/").map(decodeURIComponent),j=f.reduce((C,{route:u,...y})=>{if(u==null){if(!C.weight)return{...y,...C,weight:1}}else{let A=u.split("/");if(A.length==E.length){var o=2;let p=E.reduce((h,O,B)=>(h&&(A[B].substr(0,1)==":"?h[A[B].substr(1)]=O:A[B]!==O?h=null:o++),h),{});if(p&&o>C.weight)return{...y,route:u,Params:p,weight:o}}}return C},{route:null,Params:{},weight:0});if(j){e("done"),e=l[j.component]||l.home;let C=o=>JSON.parse(JSON.stringify(o)),u={url:g,path:s,query:b,route:j.route,Params:j.Params||{}},y={...c.reduce((o,A)=>A(o),C(u)),...u};n.forEach(o=>o("hashchange",C(y))),e("init",{...y,data:a[j.component],root:r,refresh:()=>m()})}};return f.length&&(window.addEventListener("hashchange",m),m()),()=>{f.length&&window.removeEventListener("hashchange",m),n.forEach(g=>g("done"))}};export{k as default};
