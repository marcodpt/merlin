var W=1,q=3,Y={},D=[],H="http://www.w3.org/2000/svg",F=function(r){this.events[r.type](r)},O=r=>r==null?r:r.key,Z=(r,t,e,f,p)=>{t==="key"||(t[0]==="o"&&t[1]==="n"?((r.events||(r.events={}))[t=t.slice(2)]=f)?e||r.addEventListener(t,F):r.removeEventListener(t,F):!p&&t!=="list"&&t!=="form"&&t in r?r[t]=f??"":f==null||f===!1?r.removeAttribute(t):r.setAttribute(t,f))},P=(r,t)=>{var e=r.props,f=r.type===q?document.createTextNode(r.tag):(t=t||r.tag==="svg")?document.createElementNS(H,r.tag,{is:e.is}):document.createElement(r.tag,{is:e.is});for(var p in e)Z(f,p,null,e[p],t);for(var a=0;a<r.children.length;a++)f.appendChild(P(r.children[a]=y(r.children[a]),t));return r.node=f},L=(r,t,e,f,p)=>{if(e!==f)if(e!=null&&e.type===q&&f.type===q)e.tag!==f.tag&&(t.nodeValue=f.tag);else if(e==null||e.tag!==f.tag)t=r.insertBefore(P(f=y(f),p),t),e!=null&&r.removeChild(e.node);else{var a,u,s,n,R=e.props,A=f.props,l=e.children,o=f.children,m=0,g=0,E=l.length-1,C=o.length-1;p=p||f.tag==="svg";for(var c in{...R,...A})(c==="value"||c==="selected"||c==="checked"?t[c]:R[c])!==A[c]&&Z(t,c,R[c],A[c],p);for(;g<=C&&m<=E&&!((s=O(l[m]))==null||s!==O(o[g]));)L(t,l[m].node,l[m++],o[g]=y(o[g++]),p);for(;g<=C&&m<=E&&!((s=O(l[E]))==null||s!==O(o[C]));)L(t,l[E].node,l[E--],o[C]=y(o[C--]),p);if(m>E)for(;g<=C;)t.insertBefore(P(o[g]=y(o[g++]),p),(u=l[m])&&u.node);else if(g>C)for(;m<=E;)t.removeChild(l[m++].node);else{for(var v={},b={},c=m;c<=E;c++)(s=l[c].key)!=null&&(v[s]=l[c]);for(;g<=C;){if(s=O(u=l[m]),n=O(o[g]=y(o[g])),b[s]||n!=null&&n===O(l[m+1])){s==null&&t.removeChild(u.node),m++;continue}n==null||e.type===W?(s==null&&(L(t,u&&u.node,u,o[g],p),g++),m++):(s===n?(L(t,u.node,u,o[g],p),b[n]=!0,m++):(a=v[n])!=null?(L(t,t.insertBefore(a.node,u&&u.node),a,o[g],p),b[n]=!0):L(t,u&&u.node,null,o[g],p),g++)}for(;m<=E;)O(u=l[m++])==null&&t.removeChild(u.node);for(var c in v)b[c]==null&&t.removeChild(v[c].node)}}return f.node=t},y=r=>r!==!0&&r!==!1&&r?r:_(""),$=r=>r.nodeType===q?_(r.nodeValue,r):M(r.nodeName.toLowerCase(),Y,D.map.call(r.childNodes,$),W,r),M=(r,t,e,f,p)=>({tag:r,props:t,key:t.key,children:e,type:f,node:p}),_=(r,t)=>M(r,Y,D,q,t),X=(r,t,e=D)=>M(r,t,Array.isArray(e)?e:[e]),Q=(r,t)=>((r=L(r.parentNode,r,r.vdom||$(r),t)).vdom=t,r);var N=(r,t,e)=>{t=t||(s=>s),e=e||document;let f=s=>s&&typeof s=="object"&&!(s instanceof Array),p=(s,n)=>f(s)&&f(n)?{...s,...n}:n,a=(s,n)=>typeof s=="string"&&typeof n=="string"?s+n:n,u=s=>{if(s.nodeType!=1)return()=>[t(s.textContent)];let n=s.tagName.toLowerCase(),R=Array.from(s.attributes).map(({nodeName:l,nodeValue:o})=>({key:l,value:s.getAttribute(l)})),A=Array.from((n=="template"?s.content:s).childNodes).map(l=>u(l));return(l,o,m,g)=>R.reduce((E,C)=>E.reduce((c,v)=>{let{scope:b,attributes:x}=v;var{key:h,value:i}=C;return(h.substr(0,1)==":"||h.substr(h.length-1)==":")&&(h=h.substr(0,1)==":"?h.substr(1):h.substr(0,h.length-1),i==""?i=b:b&&typeof b=="object"&&b[i]!=null?i=b[i]:i=null),h=="each"?i instanceof Array&&i.forEach(j=>{c.push({attributes:{...x},scope:p(b,j)})}):h=="with"?i!=null&&c.push({...v,scope:p(b,i)}):h=="if"||h=="not"?(h=="if"&&i||h=="not"&&!i)&&c.push(v):h=="show"||h=="hide"?((h=="hide"&&i||h=="show"&&!i)&&(x.style="display: none;"+(typeof x.style=="string"?x.style:"")),c.push({...v,attributes:x})):h=="case"?o!=null&&o==i&&c.push(v):h=="switch"?c.push({...v,word:i}):h=="bind"?(i&&typeof i=="object"&&Object.keys(i).forEach(j=>{x[j]=a(x[j],i[j])}),c.push({...v,attributes:x})):(x[h]=a(x[h],i),c.push({...v,attributes:x})),c},[]),[{scope:n=="slot"?g:l,attributes:{}}]).reduce((E,{scope:C,attributes:c,word:v})=>{let b=(n=="slot"?m:A).reduce((i,j)=>(j(C,v,m||A,g).forEach(B=>{i.push(B)}),i),[]).filter(i=>i),x=n.indexOf("-")>=0?e.getElementById(n):null;if(c.text!=null&&x==null){for(;b.length;)b.pop();b.push(t(c.text)),c={...c},delete c.text}var h=null;return n=="template"||n=="slot"?h=b:x!=null?h=u(x)(c,null,A,C):h=[r(n,c,b)],h.forEach(i=>{E.push(i)}),E},[])};return(s,n)=>{if(n){let R=s.tagName.toLowerCase(),A=Array.from(s.attributes).reduce((o,{attrName:m,attrValue:g})=>({...o,[m]:g}),{}),l=u(n);return o=>r(R,A,l(o))}else{let R=u(s);return A=>R(A)[0]}}};var w=N(X,_),T=(r,t)=>{let e=w(r,t);return f=>Q(r,e(f))};var S=({init:r,update:t,view:e,done:f})=>{var p,a=!0;let u=n=>{a&&s(t(n,p))},s=([n,R])=>{p=n,R&&R(u),e(p,u)};return s(r),()=>{a&&(a=!1,f&&f(p))}};var I=({node:r,template:t,view:e,...f})=>{let p=T(r,t);return S({...f,view:(a,u)=>{p(e?e(a,u):a)}})};var G=({init:r,routes:t,plugins:e,runtime:f})=>{let p=()=>{};r=typeof r=="function"?r:p,e=(e instanceof Array?e:[]).filter(A=>typeof A=="function");var a=p;let u=r()||{};var s=!0;let R=f(A=>{if(!s)return;let l=A.split("?"),o=l.shift(),m=o.split("/").map(decodeURIComponent),g=l.join("?"),{route:E,Params:C}=Object.keys(t).reduce((v,b)=>{let x=b.split("/");if(x.length==m.length){var h=1;let i=m.reduce((j,B,U)=>(j&&(x[U].substr(0,1)==":"?j[x[U].substr(1)]=B:x[U]!==B?j=null:h++),j),{});if(i&&h>v.weight)return{route:b,Params:i,weight:h}}return v},{route:"*",Params:{},weight:0}),c=t[E];typeof c=="function"&&(u.url=A,u.route=E,u.path=o,u.Params=C,u.query=g,e.forEach(v=>v(u)),a(u),a=c(u)||p)})||p;return()=>{s=!1,a(u),R(u)}};var J=r=>{r.Query=r.query.split("&").map(t=>t.split("=")).map(t=>({key:decodeURIComponent(t.shift()),value:decodeURIComponent(t.join("="))})).filter(({key:t})=>t!="").reduce((t,{key:e,value:f})=>(e.substr(e.length-2)=="[]"?(e=e.substr(0,e.length-2),t[e]instanceof Array||(t[e]=[]),t[e].push(f)):t[e]=f,t),{})};var z=({plugins:r,...t})=>G({...t,plugins:[J].concat(r),runtime:e=>{let f=()=>{console.log("hashchange"),e((window.location.hash||"#/").substr(1))};return window.addEventListener("hashchange",f),f(),()=>{window.removeEventListener("hashchange",f)}}});var k=({node:r,routes:t,...e})=>{let f=r.cloneNode(!0);return z({routes:Object.keys(t).reduce((p,a)=>({...p,[a]:u=>I({template:f,...t[a],node:r,init:(t[a].init||(({Params:s})=>[s]))(u)})}),t||{}),...e})};export{I as app,k as spa};
