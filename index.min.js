var U=3,q={},L=[];var O=(a,r,c,o,C)=>({tag:a,props:r,key:r.key,children:c,type:o,node:C}),R=(a,r)=>O(a,q,L,U,r),B=(a,r,c=L)=>O(a,r,Array.isArray(c)?c:[c]);var _=(a,r)=>{typeof a!="function"&&(a=(f,u,h)=>{let b=document.createElement(f);return Object.keys(u).forEach(n=>{let p=u[n];typeof p=="function"?b.addEventListener(n.substr(n.substr(0,2)=="on"?2:0),p):p!=null&&p!==!1&&b.setAttribute(n,p===!0?"":p)}),h.forEach(n=>{b.appendChild(n)}),b},typeof r!="function"&&(r=f=>document.createTextNode(f))),typeof r!="function"&&(r=f=>f);let c=f=>f&&typeof f=="object"&&!(f instanceof Array),o=(f,u)=>c(f)&&c(u)?{...f,...u}:u,C=(f,u)=>typeof f=="string"&&typeof u=="string"?f+u:u,j=f=>{if(f.nodeType!=1)return()=>[r(f.textContent)];let u=f.tagName.toLowerCase(),h=Array.from(f.attributes).map(({nodeName:n,nodeValue:p})=>({key:n,value:p})),b=Array.from((u=="template"?f.content:f).childNodes).map(n=>j(n));return(n,p,x,g)=>h.reduce((E,A)=>E.reduce((s,m)=>{let{scope:i,attributes:l}=m;var{key:t,value:e}=A;return(t.substr(0,1)==":"||t.substr(t.length-1)==":")&&(t=t.substr(0,1)==":"?t.substr(1):t.substr(0,t.length-1),e==""?e=i:i&&typeof i=="object"&&i[e]!=null?e=i[e]:e=null),t=="each"?e instanceof Array&&e.forEach(v=>{s.push({attributes:{...l},scope:o(i,v)})}):t=="with"?e!=null&&s.push({...m,scope:o(i,e)}):t=="if"||t=="not"?(t=="if"&&e||t=="not"&&!e)&&s.push(m):t=="show"||t=="hide"?((t=="hide"&&e||t=="show"&&!e)&&(l.style="display: none;"+(typeof l.style=="string"?l.style:"")),s.push({...m,attributes:l})):t=="case"?p!=null&&p==e&&s.push(m):t=="switch"?s.push({...m,word:e}):t=="bind"?(e&&typeof e=="object"&&Object.keys(e).forEach(v=>{l[v]=C(l[v],e[v])}),s.push({...m,attributes:l})):(l[t]=C(l[t],e),s.push({...m,attributes:l})),s},[]),[{scope:u=="slot"?g:n,attributes:{}}]).reduce((E,{scope:A,attributes:s,word:m})=>{let i=(u=="slot"?x:b).reduce((e,v)=>(v(A,m,x||b,g).forEach(I=>{e.push(I)}),e),[]).filter(e=>e),l=u.indexOf("-")>=0?document.getElementById(u):null;if(s.text!=null&&l==null){for(;i.length;)i.pop();i.push(r(s.text)),s={...s},delete s.text}var t=null;return u=="template"||u=="slot"?t=i:l!=null?t=j(l)(s,null,b,A):t=[a(u,s,i)],t.forEach(e=>{E.push(e)}),E},[])};return(f,u)=>{if(u){let h=f.tagName.toLowerCase(),b=Array.from(f.attributes).reduce((p,{attrName:x,attrValue:g})=>({...p,[x]:g}),{}),n=j(u);return p=>a(h,b,n(p))}else{let h=j(f);return b=>h(b)[0]}}};var J=_(B,R);var y=a=>({...a,Query:a.query.split("&").map(r=>r.split("=")).map(r=>({key:decodeURIComponent(r.shift()),value:decodeURIComponent(r.join("="))})).filter(({key:r})=>r!="").reduce((r,{key:c,value:o})=>(c.substr(c.length-2)=="[]"?(c=c.substr(0,c.length-2),r[c]instanceof Array||(r[c]=[]),r[c].push(o)):r[c]=o,r),{})}),W=({init:a,root:r,routes:c,middleware:o})=>{var C;let j=r?superfine(r):()=>{};o=[y].concat(o),a=a||[],c=c||[];let f=a.map(({root:h,controller:b,template:n})=>{let p=superfine(h,n);return b({render:p,root:h})}),u=()=>{let h=window.location.hash,b=h.split("?"),n=b.shift(),p=b.join("?"),x=n.split("/").map(decodeURIComponent),g=c.reduce((E,{route:A,...s})=>{if(A==null&&!m)return{...s,...E,weight:1};{let i=A.split("/");if(i.length==x.length){var m=2;let l=x.reduce((t,e,v)=>(t&&(i[v].substr(0,1)==":"?t[i[v].substr(1)]=e:i[v]!==e?t=null:m++),t),{});if(l&&m>E.weight)return{...s,route:A,Params:l,weight:m}}}return E},{route:null,Params:{},weight:0});if(g){let E=g.controller||(({render:s})=>s()),A=g.template?superfine(r,g.template):j;typeof C=="function"&&C(),C=o.concat(s=>E({...s,render:A,root:r,refresh:()=>u(h)})).filter(s=>typeof s=="function").reduce((s,m)=>m(s),{url:h,path:n,query:p,route:g.route,Params:g.Params||{}})}};return window.addEventListener("hashchange",u),u(),()=>{window.removeEventListener("hashchange",u),f.push(C),f.filter(h=>typeof h=="function").forEach(h=>h())}};export{W as default};
