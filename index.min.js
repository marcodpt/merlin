var M=1,B=3,P={},I=[],Z="http://www.w3.org/2000/svg",D=function(r){this.events[r.type](r)},L=r=>r==null?r:r.key,F=(r,t,f,u,m)=>{t==="key"||(t[0]==="o"&&t[1]==="n"?((r.events||(r.events={}))[t=t.slice(2)]=u)?f||r.addEventListener(t,D):r.removeEventListener(t,D):!m&&t!=="list"&&t!=="form"&&t in r?r[t]=u??"":u==null||u===!1?r.removeAttribute(t):r.setAttribute(t,u))},y=(r,t)=>{var f=r.props,u=r.type===B?document.createTextNode(r.tag):(t=t||r.tag==="svg")?document.createElementNS(Z,r.tag,{is:f.is}):document.createElement(r.tag,{is:f.is});for(var m in f)F(u,m,null,f[m],t);for(var x=0;x<r.children.length;x++)u.appendChild(y(r.children[x]=R(r.children[x]),t));return r.node=u},O=(r,t,f,u,m)=>{if(f!==u)if(f!=null&&f.type===B&&u.type===B)f.tag!==u.tag&&(t.nodeValue=u.tag);else if(f==null||f.tag!==u.tag)t=r.insertBefore(y(u=R(u),m),t),f!=null&&r.removeChild(f.node);else{var x,e,s,o,A=f.props,b=u.props,n=f.children,g=u.children,a=0,l=0,C=n.length-1,c=g.length-1;m=m||u.tag==="svg";for(var p in{...A,...b})(p==="value"||p==="selected"||p==="checked"?t[p]:A[p])!==b[p]&&F(t,p,A[p],b[p],m);for(;l<=c&&a<=C&&!((s=L(n[a]))==null||s!==L(g[l]));)O(t,n[a].node,n[a++],g[l]=R(g[l++]),m);for(;l<=c&&a<=C&&!((s=L(n[C]))==null||s!==L(g[c]));)O(t,n[C].node,n[C--],g[c]=R(g[c--]),m);if(a>C)for(;l<=c;)t.insertBefore(y(g[l]=R(g[l++]),m),(e=n[a])&&e.node);else if(l>c)for(;a<=C;)t.removeChild(n[a++].node);else{for(var E={},v={},p=a;p<=C;p++)(s=n[p].key)!=null&&(E[s]=n[p]);for(;l<=c;){if(s=L(e=n[a]),o=L(g[l]=R(g[l])),v[s]||o!=null&&o===L(n[a+1])){s==null&&t.removeChild(e.node),a++;continue}o==null||f.type===M?(s==null&&(O(t,e&&e.node,e,g[l],m),l++),a++):(s===o?(O(t,e.node,e,g[l],m),v[o]=!0,a++):(x=E[o])!=null?(O(t,t.insertBefore(x.node,e&&e.node),x,g[l],m),v[o]=!0):O(t,e&&e.node,null,g[l],m),l++)}for(;a<=C;)L(e=n[a++])==null&&t.removeChild(e.node);for(var p in E)v[p]==null&&t.removeChild(E[p].node)}}return u.node=t},R=r=>r!==!0&&r!==!1&&r?r:_(""),G=r=>r.nodeType===B?_(r.nodeValue,r):U(r.nodeName.toLowerCase(),P,I.map.call(r.childNodes,G),M,r),U=(r,t,f,u,m)=>({tag:r,props:t,key:t.key,children:f,type:u,node:m}),_=(r,t)=>U(r,P,I,B,t),J=(r,t,f=I)=>U(r,t,Array.isArray(f)?f:[f]),z=(r,t)=>((r=O(r.parentNode,r,r.vdom||G(r),t)).vdom=t,r);var W=(r,t)=>{typeof r!="function"&&(r=(e,s,o)=>{let A=document.createElement(e);return Object.keys(s).forEach(b=>{let n=s[b];typeof n=="function"?A.addEventListener(b.substr(b.substr(0,2)=="on"?2:0),n):n!=null&&n!==!1&&A.setAttribute(b,n===!0?"":n)}),o.forEach(b=>{A.appendChild(b)}),A},typeof t!="function"&&(t=e=>document.createTextNode(e))),typeof t!="function"&&(t=e=>e);let f=e=>e&&typeof e=="object"&&!(e instanceof Array),u=(e,s)=>f(e)&&f(s)?{...e,...s}:s,m=(e,s)=>typeof e=="string"&&typeof s=="string"?e+s:s,x=e=>{if(e.nodeType!=1)return()=>[t(e.textContent)];let s=e.tagName.toLowerCase(),o=Array.from(e.attributes).map(({nodeName:b,nodeValue:n})=>({key:b,value:n})),A=Array.from((s=="template"?e.content:e).childNodes).map(b=>x(b));return(b,n,g,a)=>o.reduce((l,C)=>l.reduce((c,p)=>{let{scope:E,attributes:v}=p;var{key:h,value:i}=C;return(h.substr(0,1)==":"||h.substr(h.length-1)==":")&&(h=h.substr(0,1)==":"?h.substr(1):h.substr(0,h.length-1),i==""?i=E:E&&typeof E=="object"&&E[i]!=null?i=E[i]:i=null),h=="each"?i instanceof Array&&i.forEach(j=>{c.push({attributes:{...v},scope:u(E,j)})}):h=="with"?i!=null&&c.push({...p,scope:u(E,i)}):h=="if"||h=="not"?(h=="if"&&i||h=="not"&&!i)&&c.push(p):h=="show"||h=="hide"?((h=="hide"&&i||h=="show"&&!i)&&(v.style="display: none;"+(typeof v.style=="string"?v.style:"")),c.push({...p,attributes:v})):h=="case"?n!=null&&n==i&&c.push(p):h=="switch"?c.push({...p,word:i}):h=="bind"?(i&&typeof i=="object"&&Object.keys(i).forEach(j=>{v[j]=m(v[j],i[j])}),c.push({...p,attributes:v})):(v[h]=m(v[h],i),c.push({...p,attributes:v})),c},[]),[{scope:s=="slot"?a:b,attributes:{}}]).reduce((l,{scope:C,attributes:c,word:p})=>{let E=(s=="slot"?g:A).reduce((i,j)=>(j(C,p,g||A,a).forEach(Y=>{i.push(Y)}),i),[]).filter(i=>i),v=s.indexOf("-")>=0?document.getElementById(s):null;if(c.text!=null&&v==null){for(;E.length;)E.pop();E.push(t(c.text)),c={...c},delete c.text}var h=null;return s=="template"||s=="slot"?h=E:v!=null?h=x(v)(c,null,A,C):h=[r(s,c,E)],h.forEach(i=>{l.push(i)}),l},[])};return(e,s)=>{if(s){let o=e.tagName.toLowerCase(),A=Array.from(e.attributes).reduce((n,{attrName:g,attrValue:a})=>({...n,[g]:a}),{}),b=x(s);return n=>r(o,A,b(n))}else{let o=x(e);return A=>o(A)[0]}}};var $=W(J,_),q=(r,t)=>{let f=$(r,t);return u=>z(r,f(u))};var X=r=>({...r,Query:r.query.split("&").map(t=>t.split("=")).map(t=>({key:decodeURIComponent(t.shift()),value:decodeURIComponent(t.join("="))})).filter(({key:t})=>t!="").reduce((t,{key:f,value:u})=>(f.substr(f.length-2)=="[]"?(f=f.substr(0,f.length-2),t[f]instanceof Array||(t[f]=[]),t[f].push(u)):t[f]=u,t),{})}),w=({init:r,root:t,routes:f,middleware:u})=>{var m,x;u=[X].concat(u),r=r||[],f=f||[];let e=r.map(({root:o,controller:A,template:b})=>{let n=q(o,b);return A({render:n,root:o})}),s=()=>{let o=window.location.hash,A=o.split("?"),b=A.shift(),n=A.join("?"),g=b.split("/").map(decodeURIComponent),a=f.reduce((l,{route:C,...c})=>{if(C==null){if(!l.weight)return{...c,...l,weight:1}}else{let E=C.split("/");if(E.length==g.length){var p=2;let v=g.reduce((h,i,j)=>(h&&(E[j].substr(0,1)==":"?h[E[j].substr(1)]=i:E[j]!==i?h=null:p++),h),{});if(v&&p>l.weight)return{...c,route:C,Params:v,weight:p}}}return l},{route:null,Params:{},weight:0});if(a){x||(x=document.createElement("template"),Array.from(t.children).forEach(c=>{x.content.appendChild(c.cloneNode(!0))}));let l=a.controller||(({render:c})=>c()),C=q(t,a.template||x);typeof m=="function"&&m(),m=u.concat(c=>l({...c,render:C,root:t,refresh:()=>s(o)})).filter(c=>typeof c=="function").reduce((c,p)=>p(c),{url:o,path:b,query:n,route:a.route,Params:a.Params||{}})}};return window.addEventListener("hashchange",s),s(),()=>{window.removeEventListener("hashchange",s),e.push(m),e.filter(o=>typeof o=="function").forEach(o=>o())}};export{w as default};
