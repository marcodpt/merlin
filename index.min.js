var P=(r,t,f)=>{t=t||(n=>n),f=f||document;let u=n=>n&&typeof n=="object"&&!(n instanceof Array),b=(n,e)=>u(n)&&u(e)?{...n,...e}:e,C=(n,e)=>typeof n=="string"&&typeof e=="string"?n+e:e,p=n=>{if(n.nodeType!=1)return()=>[t(n.textContent)];let e=n.tagName.toLowerCase(),o=Array.from(n.attributes).map(({nodeName:i,nodeValue:s})=>({key:i,value:n.getAttribute(i)})),g=Array.from((e=="template"?n.content:n).childNodes).map(i=>p(i));return(i,s,a,E)=>o.reduce((v,A)=>v.reduce((c,y)=>{let{scope:m,attributes:j}=y;var{key:l,value:h}=A;return(l.substr(0,1)==":"||l.substr(l.length-1)==":")&&(l=l.substr(0,1)==":"?l.substr(1):l.substr(0,l.length-1),h==""?h=m:m&&typeof m=="object"&&m[h]!=null?h=m[h]:h=null),l=="each"?h instanceof Array&&h.forEach(x=>{c.push({attributes:{...j},scope:b(m,x)})}):l=="with"?h!=null&&c.push({...y,scope:b(m,h)}):l=="if"||l=="not"?(l=="if"&&h||l=="not"&&!h)&&c.push(y):l=="show"||l=="hide"?((l=="hide"&&h||l=="show"&&!h)&&(j.style="display: none;"+(typeof j.style=="string"?j.style:"")),c.push({...y,attributes:j})):l=="case"?s!=null&&s==h&&c.push(y):l=="switch"?c.push({...y,word:h}):l=="bind"?(h&&typeof h=="object"&&Object.keys(h).forEach(x=>{j[x]=C(j[x],h[x])}),c.push({...y,attributes:j})):(j[l]=C(j[l],h),c.push({...y,attributes:j})),c},[]),[{scope:e=="slot"?E:i,attributes:{}}]).reduce((v,{scope:A,attributes:c,word:y})=>{let m=(e=="slot"?a:g).reduce((h,x)=>(x(A,y,a||g,E).forEach(B=>{h.push(B)}),h),[]).filter(h=>h),j=e.indexOf("-")>=0?f.getElementById(e):null;if(c.text!=null&&j==null){for(;m.length;)m.pop();m.push(t(c.text)),c={...c},delete c.text}var l=null;return e=="template"||e=="slot"?l=m:j!=null?l=p(j)(c,null,g,A):l=[r(e,c,m)],l.forEach(h=>{v.push(h)}),v},[])};return(n,e)=>{if(e){let o=n.tagName.toLowerCase(),g=Array.from(n.attributes).reduce((s,{attrName:a,attrValue:E})=>({...s,[a]:E}),{}),i=p(e);return s=>r(o,g,i(s))}else{let o=p(n);return g=>o(g)[0]}}};var G=1,_=3,J={},U=[],Z="http://www.w3.org/2000/svg",D=function(r){this.events[r.type](r)},O=r=>r==null?r:r.key,z=(r,t,f,u,b)=>{t==="key"||(t[0]==="o"&&t[1]==="n"?((r.events||(r.events={}))[t=t.slice(2)]=u)?f||r.addEventListener(t,D):r.removeEventListener(t,D):!b&&t!=="list"&&t!=="form"&&t in r?r[t]=u??"":u==null||u===!1?r.removeAttribute(t):r.setAttribute(t,u))},I=(r,t)=>{var f=r.props,u=r.type===_?document.createTextNode(r.tag):(t=t||r.tag==="svg")?document.createElementNS(Z,r.tag,{is:f.is}):document.createElement(r.tag,{is:f.is});for(var b in f)z(u,b,null,f[b],t);for(var C=0;C<r.children.length;C++)u.appendChild(I(r.children[C]=L(r.children[C]),t));return r.node=u},R=(r,t,f,u,b)=>{if(f!==u)if(f!=null&&f.type===_&&u.type===_)f.tag!==u.tag&&(t.nodeValue=u.tag);else if(f==null||f.tag!==u.tag)t=r.insertBefore(I(u=L(u),b),t),f!=null&&r.removeChild(f.node);else{var C,p,n,e,o=f.props,g=u.props,i=f.children,s=u.children,a=0,E=0,v=i.length-1,A=s.length-1;b=b||u.tag==="svg";for(var c in{...o,...g})(c==="value"||c==="selected"||c==="checked"?t[c]:o[c])!==g[c]&&z(t,c,o[c],g[c],b);for(;E<=A&&a<=v&&!((n=O(i[a]))==null||n!==O(s[E]));)R(t,i[a].node,i[a++],s[E]=L(s[E++]),b);for(;E<=A&&a<=v&&!((n=O(i[v]))==null||n!==O(s[A]));)R(t,i[v].node,i[v--],s[A]=L(s[A--]),b);if(a>v)for(;E<=A;)t.insertBefore(I(s[E]=L(s[E++]),b),(p=i[a])&&p.node);else if(E>A)for(;a<=v;)t.removeChild(i[a++].node);else{for(var y={},m={},c=a;c<=v;c++)(n=i[c].key)!=null&&(y[n]=i[c]);for(;E<=A;){if(n=O(p=i[a]),e=O(s[E]=L(s[E])),m[n]||e!=null&&e===O(i[a+1])){n==null&&t.removeChild(p.node),a++;continue}e==null||f.type===G?(n==null&&(R(t,p&&p.node,p,s[E],b),E++),a++):(n===e?(R(t,p.node,p,s[E],b),m[e]=!0,a++):(C=y[e])!=null?(R(t,t.insertBefore(C.node,p&&p.node),C,s[E],b),m[e]=!0):R(t,p&&p.node,null,s[E],b),E++)}for(;a<=v;)O(p=i[a++])==null&&t.removeChild(p.node);for(var c in y)m[c]==null&&t.removeChild(y[c].node)}}return u.node=t},L=r=>r!==!0&&r!==!1&&r?r:q(""),F=r=>r.nodeType===_?q(r.nodeValue,r):M(r.nodeName.toLowerCase(),J,U.map.call(r.childNodes,F),G,r),M=(r,t,f,u,b)=>({tag:r,props:t,key:t.key,children:f,type:u,node:b}),q=(r,t)=>M(r,J,U,_,t),W=(r,t,f=U)=>M(r,t,Array.isArray(f)?f:[f]),Y=(r,t)=>((r=R(r.parentNode,r,r.vdom||F(r),t)).vdom=t,r);var $=({root:r,template:t,format:f,...u})=>{var b,C=!1;f=typeof f=="function"?f:e=>e,u.init=typeof u.init=="function"?u.init:e=>e,u.done=typeof u.done=="function"?u.done:()=>null;let p=(e,o)=>{if(e=="init"&&!C||e!="init"&&C&&typeof u[e]=="function"){C=!0;let g=e=="init"?u.init(o,p):u[e](b,o,p);b=g===void 0?b:g,e=="done"?C=!1:Y(r,n(f(b)))}},n=P((e,o,g)=>(Object.keys(o||{}).forEach(i=>{if(i.substr(0,7)=="data-on"&&(i=i.substr(5)),i.substr(0,2)=="on"){let s=o[i]||o["data-"+i];o[i]=a=>{p(s,a)}}}),W(e,o,g)),q)(r,t);return p},X=r=>({...r,Query:r.query.split("&").map(t=>t.split("=")).map(t=>({key:decodeURIComponent(t.shift()),value:decodeURIComponent(t.join("="))})).filter(({key:t})=>t!="").reduce((t,{key:f,value:u})=>(f.substr(f.length-2)=="[]"?(f=f.substr(0,f.length-2),t[f]instanceof Array||(t[f]=[]),t[f].push(u)):t[f]=u,t),{})}),k=({root:r,components:t,routes:f,middleware:u,...b})=>{r=r||document.body.querySelector("main")||document.body,f=f instanceof Array?f:[],u=[X].concat(u).filter(g=>typeof g=="function"),t=t&&typeof t=="object"?t:{};let C=document.createElement("template");f.length&&(Array.from(r.children).forEach(g=>{C.content.appendChild(g.cloneNode(!0))}),t.home={template:C});let p={},n=Object.keys(t).reduce((g,i)=>{let s=t[i];s.root==null&&(s.root=r),s.root==r&&f.length&&s.template==null&&(s.template=C);let a=$(s);return g.push(a),s.root!=r||!f.length?a("init",b[i]):p[i]=a,g},[]);var e=p.home;let o=()=>{let g=window.location.hash,i=g.split("?"),s=i.shift(),a=i.join("?"),E=s.split("/").map(decodeURIComponent),v=f.reduce((A,{route:c,...y})=>{if(c==null){if(!A.weight)return{...y,...A,weight:1}}else{let j=c.split("/");if(j.length==E.length){var m=2;let l=E.reduce((h,x,B)=>(h&&(j[B].substr(0,1)==":"?h[j[B].substr(1)]=x:j[B]!==x?h=null:m++),h),{});if(l&&m>A.weight)return{...y,route:c,Params:l,weight:m}}}return A},{route:null,Params:{},weight:0});if(v){e("done"),e=p[v.component]||p.home;let A=u.reduce((c,y)=>y(c),{url:g,path:s,query:a,route:v.route,Params:v.Params||{},data:b[v.component]});e("init",{...A,root:r,refresh:()=>o(g)}),n.forEach(c=>c("router",{...A}))}};return f.length&&(window.addEventListener("hashchange",o),o()),()=>{f.length&&window.removeEventListener("hashchange",o),n.forEach(g=>g("done"))}};export{k as default};
